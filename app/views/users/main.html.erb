<input type="hidden" id="login" value="<%= @user.login %>">

<ul class="nav nav-tabs">
  <% @user.json_content.each_with_index do |row , index| %>
    <li id="<%= index %>" class="<%= 'active' if index == 0  %>"><a data-toggle="tab" href="link<%= index %>"><%= row['title'] %></a></li>
  <% end %>
</ul>

<button onclick="addTab()" >Add</button>

<div class="tab-content">
<% @user.json_content.each_with_index do |row , index| %>
  <div id="link<%= index %>" class="tab-pane fade <%= 'in active' if index == 0  %>">
    <iframe src="<%= row['src'] %>"></iframe>
  </div>
<% end %>
</div>



<script text="text/javascript">

  setInterval(function(){
    var elementos = $('ul li').toArray();

    var ativo = elementos.find(function (el) { return $(el).hasClass("active"); });

    var proximoId = 1;

    if (parseInt($(ativo).attr("id")) + 1 <= $('ul li').toArray().length)
      proximoId = parseInt($(ativo).attr("id"))+1;

    $("#" + proximoId + " a").click();

  }, 2000);

  var addTab = function(){
    var url = prompt("Please enter your url", "New tab");

    if (url != null) {
        $.ajax({
          url: "/options/add_tab/" + $("#login").val(),
          type:'POST',
          data: { 'url': url }
        })
    }
  }

</script>

